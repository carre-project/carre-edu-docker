"use strict";var angular=angular;angular.module("edumaterialApp",["ngCookies","ngSanitize","ngAnimate","ui.router","ui.bootstrap","angular-loading-bar","uuid4","ui.gravatar"]).config(["$stateProvider","$urlRouterProvider","$locationProvider","$httpProvider","$compileProvider",function(a,b,c,d,e){b.otherwise("/"),c.html5Mode(!0),e.debugInfoEnabled(!1)}]).config(["cfpLoadingBarProvider",function(a){a.latencyThreshold=300}]).config(["gravatarServiceProvider",function(a){a.defaults={size:100,"default":"mm"},a.secure=!0}]).config(["$provide",function(a){a.decorator("$state",["$delegate","$stateParams",function(a,b){return a.forceReload=function(){return a.go(a.current,b,{reload:!0,inherit:!1,notify:!0})},a}])}]).run(["$rootScope","$location","Auth","$cookies","$window","$http",function(a,b,c,d,e,f){a.$on("$stateChangeStart",function(a,d){c.isLoggedInAsync(function(a){d.authenticate&&!a&&b.path("/login")})});var g=["el","en","lt"],h=b.search().lang;h&&g.indexOf(h)>=0?c.language=h:c.language=window.CARRE_EDU_CONFIGURATION.language.substring(0,2)||"en",b.search().embed&&(a.isEmbedded=!0)}]).constant("CONFIG",{language:window.CARRE_EDU_CONFIGURATION.language.substring(0,2),api_url:window.CARRE_EDU_CONFIGURATION.api_url,token_name:window.CARRE_EDU_CONFIGURATION.token_name,auth_url:window.CARRE_EDU_CONFIGURATION.auth_url,graph_url:window.CARRE_EDU_CONFIGURATION.graph_url,subgraph_url:window.CARRE_EDU_CONFIGURATION.subgraph_url,debug:window.CARRE_EDU_CONFIGURATION.debug}),"serviceWorker"in navigator&&navigator.serviceWorker.register("/service-worker.js").then(function(a){})["catch"](function(a){}),angular.module("edumaterialApp").service("article",["rdf","uuid4","rank","Auth","CONFIG",function(a,b,c,d,e){function f(){a.find([["?s",a.pre.edu+"#url","?url"],["?rating",a.pre.edu+"#for_article","?s"],["?rating",a.pre.edu+"#rated_by_user",o.graphName]],["?url ?rating"],["LIMIT 1000"]).then(function(a){m=a.data})}function g(b){for(var c="SELECT ?url (AVG(?ratingval) as ?ratingavg) FROM <http://"+e.graph_url+"/"+e.subgraph_url+"> WHERE {",f=0;f<b.length;f++)b[f].url=b[f].url||"http://"+d.language+".wikipedia.org/wiki/"+encodeURIComponent(b[f].title).split("%20").join("_"),c+="{ ?s <"+a.pre.edu+"#url> <"+b[f].url+"> }",f<b.length-1&&(c+=" UNION ");return c+=" .?s <"+a.pre.edu+"#url> ?url . ?rating <"+a.pre.rdftype+"> <"+a.pre.edu+"#rating> . ?rating <"+a.pre.edu+"#for_article> ?s . ?rating ?any ?ratingval . FILTER (datatype(?ratingval) = xsd:nonNegativeInteger) } GROUP BY ?url LIMIT 20",a.query(c).then(function(a){return l=a.data})["catch"](function(a){})}function h(b){var c="http://"+e.graph_url+"/"+e.subgraph_url+"/educational/"+b;return a.find([[c,a.pre.edu+"#url","?url"],[c,a.pre.edu+"#title","?title"],[c,a.pre.edu+"#snippet","?snippet"]],["?url ?title ?snippet"],["LIMIT 100"])}function i(c){return c.riskElement=c.riskElement,n=c,a.find([["?id",a.pre.edu+"#url",c.url],["?id",a.pre.edu+"#views","?views"]],["?id ?views"],["LIMIT 1"]).then(function(a){var d={};a.data.data.length>0?(d=a.data.data[0],c.id=d.id.value.split(e.graph_url+"/"+e.subgraph_url+"/educational/")[1],c.views=Number(d.views.value),j({id:c.id,views:c.views,url:c.url,riskElement:c.riskElement})):(c.id=b.generate(),c.views=1,k(c)),n.id=c.id})["catch"](function(a){return!1})}function j(b){var c=[],d=[];c.push([a.pre.publicUri+b.id,a.pre.edu+"#views",'"'+b.views+'"^^xsd:nonNegativeInteger']),d.push([a.pre.publicUri+b.id,a.pre.edu+"#views",'"'+(b.views+1)+'"^^xsd:nonNegativeInteger']),a.modify(c,c,d).then(function(a){})["catch"](function(a){})}function k(b){var c=[];c.push([a.pre.publicUri+b.id,a.pre.rdftype,a.pre.edu+"#object"]),c.push([a.pre.publicUri+b.id,a.pre.edu+"#url",b.url]),c.push([a.pre.publicUri+b.id,a.pre.edu+"#views",'"'+b.views+'"^^xsd:nonNegativeInteger']),b.date&&c.push([a.pre.publicUri+b.id,a.pre.edu+"#date_accepted",'"'+b.date+'"^^xsd:date']),b.title&&c.push([a.pre.publicUri+b.id,a.pre.edu+"#title",'"'+encodeURIComponent(b.title)+'"^^xsd:string']),b.snippet&&c.push([a.pre.publicUri+b.id,a.pre.edu+"#snippet",'"'+encodeURIComponent(b.snippet)+'"^^xsd:string']),b.lang&&c.push([a.pre.publicUri+b.id,a.pre.edu+"#language",'"'+b.lang+'"^^xsd:string']),b.wordcount&&c.push([a.pre.publicUri+b.id,a.pre.edu+"#wordcount",'"'+b.wordcount+'"^^xsd:nonNegativeInteger']),b.categories&&c.push([a.pre.publicUri+b.id,a.pre.edu+"#categories",'"'+b.categories+'"^^xsd:string']),b.source&&c.push([a.pre.publicUri+b.id,a.pre.edu+"#source",'"'+b.source+'"^^xsd:string']),b.websource&&c.push([a.pre.publicUri+b.id,a.pre.edu+"#websource",'"'+b.websource+'"^^xsd:string']),b.altTitle&&c.push([a.pre.publicUri+b.id,a.pre.edu+"#alternative_title",'"'+b.altTitle+'"^^xsd:string']),a.insert(c).then(function(a){})["catch"](function(a){})}var l=[],m=[],n={},o={};return d.token?d.getCurrentUser().$promise?d.getCurrentUser().then(function(){o=d.getCurrentUser()}):o=d.getCurrentUser():o={},o.hasOwnProperty("username")||(o.graphName=a.pre.users+"guestuser"),{getById:h,getUserRated:f,getRated:g,userRated:function(){return m},rated:function(){return l},insert:i,getCurrent:function(){return n}}}]),String.prototype.distance=function(a){var b;b=this;var c,d,e,f,g,h,i,j,k,l,m;for(b.length>a.length&&(a=[a,b],b=a[0],a=a[1]),f=~~Math.max(0,a.length/2-1),g=[],h=[],d=k=0,m=b.length;k<m;d=++k)for(c=b[d],j=Math.max(0,d-f),i=Math.min(d+f+1,a.length),e=l=j;j<=i?l<i:l>i;e=j<=i?++l:--l)if(null==h[e]&&c===a[e]){g[d]=c,h[e]=a[e];break}if(g=g.join(""),h=h.join(""),e=g.length){for(d=i=f=0,j=g.length;i<j;d=++i)c=g[d],c!==h[d]&&f++;for(d=h=g=0,i=b.length;h<i&&(c=b[d],c===a[d]);d=++h)g++;b=(e/b.length+e/a.length+(e-~~(f/2))/e)/3,b+=.1*Math.min(g,4)*(1-b)}else b=0;return b},angular.module("edumaterialApp").service("jaroWinkler",function(){return!0}),angular.module("edumaterialApp").controller("MainCtrl",["CONFIG","$scope","$http","Auth","$location","$state","suggest","$sce","main","$timeout","medlineplus","$window","article","rating",function(a,b,c,d,e,f,g,h,i,j,k,l,m,n){function o(){b.total=0,b.results=[],f.params.searchquery&&(b.queryTerm=f.params.searchquery,j(function(){b.searchQuery()},50)),f.params.eduid&&m.getById(f.params.eduid).then(function(a){b.results=[{title:a.data.data[0].title.value,url:a.data.data[0].url.value,snippet:a.data.data[0].snippet.value}],v(!0)}),d.searchQuery&&(b.queryTerm=d.searchQuery,b.searchQuery())}function p(a){return String(a).replace(/<[^>]+>/gm,"")}b.isLoggedIn=d.isLoggedIn;var q={};d.token?d.getCurrentUser().$promise?d.getCurrentUser().then(function(){q=d.getCurrentUser()}):q=d.getCurrentUser():q={},b.user=q,b.beta=!1,b.nextElement=function(){b.betaCurrentElement=b.betaCurrentElement||1,b.betaCurrentElement++,b.onComplete(b.riskElements[b.betaCurrentElement],b.riskElements)},b.riskElements=[],g.riskelements().then(function(a){b.riskElements=a,b.beta&&b.nextElement()}),b.docSources=[{label:"Wikipedia",value:"wikipedia"}],b.curSource=b.docSources[0],"en"===d.language&&b.docSources.push({label:"MedlinePLUS",value:"medlineplus"}),b.itemsPerPage=10,b.currentPage=1,b.rating=[{rdftype:"depth_of_coverage",name:"Depth of Coverage",value:0},{rdftype:"comprehensiveness",name:"Comprehensiveness",value:0},{rdftype:"relevancy",name:"Relevancy",value:0},{rdftype:"accuracy",name:"Accuracy",value:0},{rdftype:"educational_level",name:"Educational level",value:0},{rdftype:"validity",name:"Validity",value:0}],d.rating_criteria=b.rating,b.getSuggestions=function(a){return g["for"](a)},b.onComplete=function(a,c,d){b.beta&&(b.queryTerm=a.name),a&&(b.riskElement=a),b.searchQuery()},b.toggleArticle=function(a){a>-1?(b.showArticle=!0,b.frameHeight=l.innerHeight-50,b.mobile=!0,b.doc=b.results[a],b.doc.pos=a,b.doc.rating=b.doc.rating||[],b.doc.iframe="",b.doc.riskElement=b.riskElement?b.riskElement.url:"",j(function(){b.doc.iframe=s(),document.querySelector("body").style.overflowY=b.showArticle?"hidden":"visible"},900)):(b.isLoggedIn()&&i.setRating(b.doc.rating).then(function(a){v()}),b.isCollapsed=!1,b.doc={},b.doc.iframe="",b.showArticle=!1,j(function(){document.querySelector("body").style.overflowY=b.showArticle?"hidden":"visible"},100))};var r=function(){i.setArticle({title:p(b.doc.title),snippet:p(b.doc.FullSummary||b.doc.snippet),date:(new Date).toISOString(),url:b.doc.url,websource:b.curSource.value,source:p(b.doc.organizationName||""),mesh:p(b.doc.mesh||""),lang:d.language,altTitle:p(b.doc.altTitle||""),categories:p(b.doc.groupName||""),wordcount:b.doc.wordcount||"",riskElement:b.doc.riskElement}),i.setRank({position:b.doc.pos,total:b.total,date:(new Date).toISOString(),query:encodeURIComponent(b.queryTerm),article_risk:b.doc.riskElement}),b.isLoggedIn()&&n.load({url:b.doc.url}).then(function(a){var c=a.data.data[0];b.doc.rating=[];for(var d=0;d<6;d++)b.doc.rating[d]={value:0};c&&(b.doc.rating[0].value=c.depth_of_coverage.value||0,b.doc.rating[1].value=c.comprehensiveness.value||0,b.doc.rating[2].value=c.relevancy.value||0,b.doc.rating[3].value=c.accuracy.value||0,b.doc.rating[4].value=c.educational_level.value||0,b.doc.rating[5].value=c.validity.value||0)}),i.editArticle()},s=function(){var a="";switch(b.doc.title=p(b.doc.title),b.curSource.value){case"medlineplus":a=b.mobile?'<div style="background:#ffffff;height:'+b.frameHeight+'px; overflow-y:auto;"><h2>'+b.doc.title+"</h2><p>"+b.doc.FullSummary+"</p></div>":'<base target="_blank" /><iframe style="width:100%;height:'+b.frameHeight+'px;" class="embed-responsive-item" src="'+b.doc.url.replace("http://","https://")+'"sandbox="allow-same-origin"></iframe>';break;case"wikipedia":b.doc.iframeurl="/api/wikipedia/proxy/"+d.language+"/"+encodeURIComponent(b.doc.title).split("%20").join("_"),a='<base target="_blank" /><iframe style="width:100%;height:'+b.frameHeight+'px;" class="embed-responsive-item" src="'+b.doc.iframeurl+'"></iframe>'}return r(),h.trustAsHtml(a)};b.searchQuery=function(){if(void 0!=b.queryTerm&&""!==b.queryTerm)switch(d.searchQuery=b.queryTerm,d.notifyNavbar(),b.curSource.value){case"medlineplus":t();break;case"wikipedia":u()}};var t=function(){k.search((b.currentPage-1)*b.itemsPerPage,b.queryTerm,b.itemsPerPage).then(function(c){a.debug,c.data.message?(b.total=0,b.results=[]):(b.results=c.data.list,b.total=Number(c.data.count[0]),b.pageCount=Math.ceil(b.total/b.itemsPerPage),b.total>b.itemsPerPage&&b.results.retstart&&(b.currentPage=Math.ceil(b.results.retstart[0]/b.itemsPerPage)+1),v())})},u=function(){c.get("/api/wikipedia/search/"+encodeURIComponent(b.queryTerm)+"/"+b.itemsPerPage+"/"+(b.currentPage-1)*b.itemsPerPage+"/"+d.language,{cache:!0}).then(function(c){a.debug,c.data.search.length>0?(b.results=c.data.search,b.total=c.data.searchinfo.totalhits,b.pageCount=Math.ceil(b.total/b.itemsPerPage),b.suggestion=c.data.searchinfo.suggestion,v()):(b.total=0,b.results=[])})};o();var v=function(a){m.getRated(b.results).then(function(c){for(var d=0,e=c.data;d<e.length;d++)for(var f=0;f<b.results.length;f++)b.results[f].url===e[d].url.value&&(b.results[f].avgRating=e[d].ratingavg.value);a&&j(function(){b.toggleArticle(0)},100),b.beta&&b.start()})};b.start=function(){var a=b.results.length>20?20:b.results.length,c=function(){b.toggleArticle(a-1),j(function(){b.toggleArticle(-1)},4e3),a-=1,a>=0?j(c,5e3):b.beta&&a===-1&&b.nextElement()};c()}}]),angular.module("edumaterialApp").config(["$stateProvider",function(a){a.state("main",{url:"/",templateUrl:"app/main/main.html",controller:"MainCtrl"}).state("search",{url:"/search/:searchquery?",templateUrl:"app/main/main.html",controller:"MainCtrl"}).state("article",{url:"/article/:eduid?",templateUrl:"app/main/main.html",controller:"MainCtrl"})}]),angular.module("edumaterialApp").service("main",["$q","article","rdf","rank","rating","CONFIG",function(a,b,c,d,e,f){function g(){a.all([b.insert(j).then(function(){return j.id=b.getCurrent().id,k.article_id=j.id,k.article_risk=b.getCurrent().riskElement,d.insert(k)},function(a){})]).then(function(a){})}function h(){a.all([b.insert(j).then(function(){return j.id=b.getCurrent().id,k.article_id=j.id,k.article_risk=b.getCurrent().riskElement,d.insert(k)},function(a){})]).then(function(a){})}function i(){var a="PREFIX rdfs: <http://www.w3.org/2000/01/rdf-schema#> PREFIX edu: <http://"+f.graph_url+"/ontology/educational.owl#> PREFIX rdftype: <http://www.w3.org/1999/02/22-rdf-syntax-ns#> PREFIX dc: <http://purl.org/dc/elements/1.1/> PREFIX users: <https://"+f.graph_url+"/users/> SELECT ?title ?url ?views (count(?rating) as ?ratings) WHERE { ?s rdf:type edu:object. ?s edu:title ?title. ?s edu:url ?url. ?s edu:views ?views. ?rating rdf:type edu:rating. ?rating edu:for_article ?s. } ";return c.query(a).then(function(a){})["catch"](function(a){})}var j={},k={};return{setArticle:function(a){j=a},article:function(){return j},setRank:function(a){k=a},rank:function(){return k},setRating:function(a){return j.rating=a,e.insert(j)},rating:function(){return j.rating},editArticle:g,fetchArticles:h,exampleQuery:i}}]),angular.module("edumaterialApp").factory("medlineplus",["$http",function(a){function b(b,d,e){var f=c.apiurl+"term="+encodeURIComponent(d)+"&retstart="+(b||0)+"&db="+c.db+"&rettype="+c.rettype+"&retmax="+(e||c.retmax)+"&tool="+c.tool+"&email="+c.email;return a.get(f,{cache:!0})}var c={apiurl:"/api/medlineplus/query/",db:"healthTopics",rettype:"brief",retmax:10,tool:"carre-project-educational-aggregator",email:"portokallidis@gmail.com"};return{search:b}}]),angular.module("edumaterialApp").service("rank",["rdf","uuid4","CONFIG",function(a,b,c){function d(d){return a.find([["?id",a.pre.rdftype,a.pre.edu+"#rank"],["?id",a.pre.edu+"#for_article",a.pre.publicUri+d.article_id],["?id",a.pre.edu+"#query",'"'+d.query+'"^^xsd:string']],["?id"],["LIMIT 1"]).then(function(a){var h={};return a.data.length>0?(h=a.data.data[0],d.id=h.id.value.split(c.graph_url+"/"+c.subgraph_url+"/educational/rank/")[1],e(d)):(d.id=b.generate(),f(d)),g(d),d.id},function(a){return!1})}function e(b){var c=[],d=[];c.push([a.pre.publicUri+"rank/"+b.id,a.pre.edu+"#date","?date"]),c.push([a.pre.publicUri+"rank/"+b.id,a.pre.edu+"#total","?total"]),c.push([a.pre.publicUri+"rank/"+b.id,a.pre.edu+"#total","?pos"]),d.push([a.pre.publicUri+"rank/"+b.id,a.pre.edu+"#date",'"'+b.date+'"^^xsd:date']),d.push([a.pre.publicUri+"rank/"+b.id,a.pre.edu+"#total",'"'+b.total+'"^^xsd:nonNegativeInteger']),d.push([a.pre.publicUri+"rank/"+b.id,a.pre.edu+"#total",'"'+b.position+'"^^xsd:nonNegativeInteger']),a.modify(c,c,d).then(function(a){})["catch"](function(a){})}function f(b){var c=[];c.push([a.pre.publicUri+"rank/"+b.id,a.pre.rdftype,a.pre.edu+"#rank"]),c.push([a.pre.publicUri+"rank/"+b.id,a.pre.edu+"#for_article",a.pre.publicUri+b.article_id]),c.push([a.pre.publicUri+"rank/"+b.id,a.pre.edu+"#query",'"'+b.query+'"^^xsd:string']),c.push([a.pre.publicUri+"rank/"+b.id,a.pre.edu+"#date",'"'+b.date+'"^^xsd:date']),c.push([a.pre.publicUri+"rank/"+b.id,a.pre.edu+"#total",'"'+b.total+'"^^xsd:nonNegativeInteger']),c.push([a.pre.publicUri+"rank/"+b.id,a.pre.edu+"#position",'"'+b.position+'"^^xsd:nonNegativeInteger']),a.insert(c).then(function(a){})["catch"](function(a){})}function g(b){var d=[];b.article_risk&&d.push([b.article_risk,"http://"+c.graph_url+"/ontology/risk.owl#has_educational_material",a.pre.publicUri+b.article_id]),a.insert(d).then(function(a){})["catch"](function(a){})}return{insert:d}}]),angular.module("edumaterialApp").service("rating",["rdf","uuid4","Auth","CONFIG",function(a,b,c,d){function e(c){var e=c.rating.reduce(function(a,b){return a+Number(b.value)},0);return 0!==e&&a.find([["?id",a.pre.rdftype,a.pre.edu+"#rating"],["?id",a.pre.edu+"#for_article",a.pre.publicUri+c.id],["?id",a.pre.edu+"#rated_by_user",i.graphName]],["?id"],["LIMIT 1"]).then(function(a){var e=a.data.data[0],f={};return f.article_id=c.id,f.rates=c.rating,f.date=(new Date).toISOString(),e&&e.id?(f.id=e.id.value.split(d.graph_url+"/"+d.subgraph_url+"/educational/rating/")[1],g(f)):(f.id=b.generate(),h(f))})["catch"](function(a){return!1})}function f(b){return a.find([["?id",a.pre.rdftype,a.pre.edu+"#rating"],["?article",a.pre.edu+"#url",b.url],["?id",a.pre.edu+"#for_article","?article"],["?id",a.pre.edu+"#rated_by_user",i.graphName],["?id",a.pre.edu+"#depth_of_coverage","?depth_of_coverage"],["?id",a.pre.edu+"#comprehensiveness","?comprehensiveness"],["?id",a.pre.edu+"#relevancy","?relevancy"],["?id",a.pre.edu+"#accuracy","?accuracy"],["?id",a.pre.edu+"#educational_level","?educational_level"],["?id",a.pre.edu+"#validity","?validity"]],["?depth_of_coverage ?comprehensiveness ?relevancy ?accuracy ?educational_level ?validity"])}function g(b){var d=[],e=[];d.push([a.pre.publicUri+"rating/"+b.id,a.pre.edu+"#date","?date"]);for(var f=0,g=c.rating_criteria;f<g.length;f++)b.rates[f]||(b.rates[f]={value:0}),d.push([a.pre.publicUri+"rating/"+b.id,a.pre.edu+"#"+g[f].name.replace(/\s+/g,"_").toLowerCase(),"?ra"+f]);e.push([a.pre.publicUri+"rating/"+b.id,a.pre.edu+"#date",'"'+b.date+'"^^xsd:date']);for(var f=0,g=c.rating_criteria;f<g.length;f++)b.rates[f]||(b.rates[f]={value:0}),e.push([a.pre.publicUri+"rating/"+b.id,a.pre.edu+"#"+g[f].name.replace(/\s+/g,"_").toLowerCase(),'"'+b.rates[f].value+'"^^xsd:nonNegativeInteger']);return a.modify(d,d,e).then(function(a){})["catch"](function(a){})}function h(b){var d=[];d.push([a.pre.publicUri+"rating/"+b.id,a.pre.rdftype,a.pre.edu+"#rating"]),d.push([a.pre.publicUri+"rating/"+b.id,a.pre.edu+"#for_article",a.pre.publicUri+b.article_id]),d.push([a.pre.publicUri+"rating/"+b.id,a.pre.edu+"#rated_by_user",i.graphName]),d.push([a.pre.publicUri+"rating/"+b.id,a.pre.edu+"#date",'"'+b.date+'"^^xsd:date']);for(var e=0,f=c.rating_criteria;e<f.length;e++)b.rates[e]||(b.rates[e]={value:0}),d.push([a.pre.publicUri+"rating/"+b.id,a.pre.edu+"#"+f[e].name.replace(/\s+/g,"_").toLowerCase(),'"'+b.rates[e].value+'"^^xsd:nonNegativeInteger']);return a.insert(d).then(function(a){})["catch"](function(a){})}var i={};return c.token?c.getCurrentUser().$promise?c.getCurrentUser().then(function(){i=c.getCurrentUser()}):i=c.getCurrentUser():i={},i.username||(i.graphName=a.pre.users+"guestuser"),{insert:e,load:f}}]),angular.module("edumaterialApp").service("rdf",["$http","$q","CONFIG",function(a,b,c){function d(a,b,c,d,e,f){return a&&a.indexOf("http")>=0&&!d&&(a="<"+a+">"),b&&b.indexOf("http")>=0&&!e&&(b="<"+b+">"),c&&c.indexOf("http")>=0&&!f&&(c="<"+c+">"),a+" "+b+" "+c}function e(a){return a.map(function(a){return d(a[0],a[1],a[2])}).join(".")}function f(d){return c.debug,d.indexOf("undefined")>=0?b.defer().promise:a.post("/api/resources/query",{sparql:d},{ignoreLoadingBar:!0})}function g(a,b,d){return b||(b=["*"]),a||(a=["?s ?p ?o"]),d||(d=["LIMIT 20"]),f("SELECT "+b.join(" ")+" FROM <http://"+c.graph_url+"/"+c.subgraph_url+"> WHERE { "+e(a)+"} "+d.join(" "))}function h(a,b,d){return a||(a=[]),d||(d=[]),b||(b=[]),f("MODIFY <http://"+c.graph_url+"/"+c.subgraph_url+"> DELETE { "+e(b)+" } INSERT { "+e(d)+" } WHERE { "+e(a)+"} ")}function i(a){return!a||a.length<1?b.reject({error:"You have not specified any triples",data:a}):f("INSERT DATA { GRAPH <http://"+c.graph_url+"/"+c.subgraph_url+"> { "+e(a)+"}}")}var j={edu:"http://"+c.graph_url+"/ontology/educational.owl",rdftype:"http://www.w3.org/1999/02/22-rdf-syntax-ns#type",dc:"http://purl.org/dc/elements/1.1/",publicUri:"http://"+c.graph_url+"/"+c.subgraph_url+"/educational/",users:"https://"+c.graph_url+"/users/"};return{query:f,find:g,insert:i,modify:h,pre:j}}]),angular.module("edumaterialApp").factory("suggest",["$http","Auth","CONFIG",function(a,b,c){var d=function(b){return b.length>2?a.get("/api/wikipedia/autocomplete/"+encodeURIComponent(b),{cache:!0,ignoreLoadingBar:!0}).then(function(a){return a.data.length>1?a.data:[]}):[]},e=function(){return a.get("/api/resources/elements/risk_element/"+b.language,{cache:!0,ignoreLoadingBar:!0}).then(function(a){return a.data.data.length>1?a.data.data:[]})};return{"for":d,riskelements:e}}]),angular.module("edumaterialApp").service("Translate",["Auth",function(a){var b={en:{depth_of_coverage:"Depth of Coverage",comprehensiveness:"Comprehensiveness",relevancy:"Relevancy",accuracy:"Accuracy",educational_level:"Educational level",validity:"Validity",total_results:"results",no_results:"No results...",back_button:"Back",rating_button:"Rating",rating_title:"Article Rating",home_page:"Home",login:"Log in",logout:"Log out",pagination_next:"Next",pagination_prev:"Previous"},el:{depth_of_coverage:"Βάθος ανάλυσης περιεχομένου",comprehensiveness:"Κατανόηση",relevancy:"Σχετικότητα",accuracy:"Ακρίβεια",educational_level:"Απαιτούμενο επίπεδο εκπαίδευσης",validity:"Εγκυρότητα",total_results:"αποτελέσματα",no_results:"Κανένα αποτέλεσμα...",back_button:"Πίσω",rating_button:"Αξιολόγηση",rating_title:"Αξιολόγηση περιεχομένου",home_page:"Αρχική",login:"Σύνδεση",logout:"Αποσύνδεση",pagination_next:"Επόμενα",pagination_prev:"Προηγούμενα"},lt:{depth_of_coverage:"Gylis dangos",comprehensiveness:"Išsamumas",relevancy:"Tinkamumas",accuracy:"Tikslumas",educational_level:"Išsilavinimo lygis reikalavimai",validity:"Galiojimas",total_results:"rezultatai",no_results:"Jokių rezultatų...",back_button:"Atgal",rating_button:"Reitingas",rating_title:"Vertinimas straipsnis",home_page:"Titulinis puslapis",login:"Prisijungti",logout:"Atsijungti",pagination_next:"Kitas",pagination_prev:"Ankstesnis"}};return function(c){return a.language&&b[a.language].hasOwnProperty(c)?b[a.language][c]:c}}]).filter("translate",["Translate",function(a){return function(b){return a(b)}}]),angular.module("edumaterialApp").factory("Auth",["$location","$rootScope","$http","$cookies","$q","$window","CONFIG",function(a,b,c,d,e,f,g){function h(){j&&!i.username&&(i=c.get(g.api_url+"/userProfile?token="+j,{cache:!0}).then(function(a){i=a.data},function(a){this.logout()}))}var i={},j=d.get(g.token_name)||!1;return h(),{authenticate:h,login:function(b,c){f.location.href=g.auth_url+"login?next="+a.absUrl()},logout:function(){i={},f.location.href=g.auth_url+"logout?next="+a.absUrl()},getCurrentUser:function(){return i},isLoggedIn:function(){return i.hasOwnProperty("username")},isLoggedInAsync:function(a){i.hasOwnProperty("$promise")?i.$promise.then(function(){a(!0)})["catch"](function(){a(!1)}):a(i.hasOwnProperty("username")?!0:!1)},isAdmin:function(){return"admin"===i.role},isMedicalExpert:function(){return"medical_expert"===i.role},token:j}}]),angular.module("edumaterialApp").factory("Modal",["$rootScope","$modal",function(a,b){function c(c,d){var e=a.$new();return c=c||{},d=d||"modal-default",angular.extend(e,c),b.open({templateUrl:"components/modal/modal.html",windowClass:d,scope:e})}return{confirm:{"delete":function(a){return a=a||angular.noop,function(){var b,d=Array.prototype.slice.call(arguments),e=d.shift();b=c({modal:{dismissable:!0,title:"Confirm Delete",html:"<p>Are you sure you want to delete <strong>"+e+"</strong> ?</p>",buttons:[{classes:"btn-danger",text:"Delete",click:function(a){b.close(a)}},{classes:"btn-default",text:"Cancel",click:function(a){b.dismiss(a)}}]}},"modal-danger"),b.result.then(function(b){a.apply(b,d)})}}}}}]),angular.module("edumaterialApp").controller("NavbarCtrl",["$scope","$location","Auth","$state","$window",function(a,b,c,d,e){a.isCollapsed=e.innerWidth<768,a.isLoggedIn=c.isLoggedIn,a.login=c.login,a.isAdmin=c.isAdmin,a.getCurrentUser=c.getCurrentUser,a.query=c.searchQuery,c.notifyNavbar=function(){a.query=c.searchQuery},c.token?c.getCurrentUser.then?c.getCurrentUser().then(function(){a.user=c.getCurrentUser()}):a.user=c.getCurrentUser():a.user={},a.logout=function(){a.user={},c.logout()},a.isActive=function(a){return a===b.path()}}]),angular.module("edumaterialApp").filter("propsFilter",function(){return function(a,b){var c=[];return angular.isArray(a)?a.forEach(function(a){for(var d=!1,e=Object.keys(b),f=0;f<e.length;f++){var g=e[f],h=b[g].toLowerCase();if(a[g].toString().toLowerCase().indexOf(h)!==-1){d=!0;break}}d&&c.push(a)}):c=a,c}}),angular.module("edumaterialApp").filter("strip",function(){return function(a){return String(a).replace(/<[^>]+>/gm,"")}}),angular.module("edumaterialApp").run(["$templateCache",function(a){a.put("app/main/article_view.html",'<!--ARTICLE PREVIEW--><div class="overlay overlay-door" ng-class="{\'open\':showArticle}"><div class="well preview-container"><div class="clearfix row preview-status"><div class=col-sm-6><button type=button ng-click=toggleArticle(-1) class="overlay overlay-close carre-btn"><span class="glyphicon glyphicon-circle-arrow-left"></span></button></div><div class=col-sm-6><button type=button ng-click="isCollapsed=!isCollapsed" ng-class="{\'active\':isCollapsed}" class="overlay overlay-edit carre-btn"><span class="glyphicon glyphicon-edit"></span></button></div></div><div class="clearfix row rating-container" uib-collapse=!isCollapsed><div class="col-xs-12 col-sm-12 col-md-12"><div class="panel panel-default"><div class=panel-heading><h3 class=panel-title>Extra Information</h3></div><div class=panel-body><h4>Coming soon!</h4></div></div></div><div ng-if=isLoggedIn() class="col-xs-12 col-sm-12 col-md-12"><div class="panel panel-default"><div class=panel-heading><h3 class=panel-title>Article Rating</h3></div><div class=panel-body><div class=row><div class=col-sm-4 ng-repeat="rate in rating track by $index">{{rate.name}} :<rating class=rating ng-model=doc.rating[$index].value max=5></rating></div></div></div></div></div></div></div><div style="position:relative; width:auto; height:auto; margin:auto; top:100px" ng-hide=doc.iframe||!showArticle class=spinner><div class=bounce1></div><div class=bounce2></div><div class=bounce3></div></div><div style=height:100% class="embed-responsive embed-responsive-4by3" ng-bind-html=doc.iframe></div></div>'),a.put("app/main/main.html",'<header class=hero-unit id=banner><!--<div ng-hide="isLoggedIn()" class="container">--><!--  <h2>CARRE Educational Resources</h2>--><!--  <p><a style="color:white" href="/login">Login</a> to enable rating</p>--><!--</div>--><div class=container><p style=height:5px></p><form ng-submit=searchQuery()><div class=row><div class="col-sm-8 col-sm-offset-2"><div class="input-group search-panel row"><div class=input-group-btn><select class=form-control style="min-width:140px;z-index: inherit" ng-model=curSource ng-options="opt as opt.label for opt in docSources" ng-change=onComplete()></select></div><input ng-model=queryTerm style="z-index: inherit" uib-typeahead="term.name for term in riskElements| filter:$viewValue | limitTo:8" class=form-control typeahead-editable=true typeahead-focus-first=false typeahead-on-select="onComplete($item, $model, $label)"> <span class=input-group-btn style="z-index: 0"><button class="btn btn-default" ng-click=searchQuery() type=submit><span class="glyphicon glyphicon-search"></span></button></span></div></div></div><!--<div class="row">--><!--  <div class="col-sm-8 col-sm-offset-2">--><!--    <h4 ng-show="total>0" class="text-left"><strong class="text-danger">{{total}}</strong> results</h4>--><!--    <div class="text-right"></div>--><!--  </div>--><!--</div>--></form></div></header><!--Wikipedia typeahead--><!--<input style="z-index: inherit;" type="text" ng-model="queryTerm" placeholder="Type terms" typeahead="term for term in getSuggestions($viewValue)" typeahead-loading="loading" class="form-control" typeahead-on-select="onComplete($label)">--><div class=results><div class="col-md-10 col-md-offset-1 col-sm-12"><div class=row><!--top pagination--><div class="col-sm-8 pull-right"><uib-pagination ng-show="total>itemsPerPage" items-per-page=itemsPerPage previous-text="{{\'pagination_prev\'|translate}}" next-text="{{\'pagination_next\'|translate}}" style="z-index: inherit; float:right; margin:auto" total-items=total ng-model=currentPage ng-change=searchQuery(true) max-size=3 rotate=false></uib-pagination></div><div class="col-sm-4 pull-left"><!--total results--><h3 ng-show="total>0"><strong class=text-danger>{{total}}</strong> {{\'total_results\'|translate}}</h3></div></div><div class=row><div class=col-xs-12><!-- Suggestions --><!--<div ng-show="suggestion">--><!--    <h4>Did you mean <a href="" ng-click="suggest(suggestion)">{{suggestion}}</a>?</h4>--><!--    <hr>--><!--</div>--><!-- no results --><div class="alert alert-warning" ng-hide="total>0||results.length>0">{{\'no_results\'|translate}}</div><div class=list-group><a href="" ng-click=toggleArticle($index) class=list-group-item ng-repeat="doc in results track by $index"><h4 class=list-group-item-heading>{{doc.title|strip}} <span class="label label-info">{{doc.avgRating|number:1 }}</span></h4><p class=list-group-item-text ng-bind-html=doc.snippet></p></a></div></div></div></div></div><!--ARTICLE PREVIEW--><div class="overlay overlay-door" ng-class="{\'open\':showArticle}"><div class=preview-container><div class="clearfix row preview-status"><div class=col-sm-6><button type=button ng-click=toggleArticle(-1) class="overlay overlay-close carre-btn"><span class="glyphicon glyphicon-circle-arrow-left"></span> <span>{{\'back_button\'|translate}}</span></button></div><div class=col-sm-6><button ng-show=isLoggedIn() type=button ng-click="isCollapsed=!isCollapsed" ng-class="{\'active\':isCollapsed}" class="overlay overlay-edit carre-btn"><span>{{\'rating_button\'|translate}}</span> <span class="glyphicon glyphicon-edit"></span></button></div></div><div class="clearfix row rating-container" uib-collapse=!isCollapsed><div class="col-xs-12 col-sm-12 col-md-12"><!--<div class="panel panel-default">--><!--  <div class="panel-heading">--><!--    <h3 class="panel-title">Extra Information</h3>--><!--  </div>--><!--  <div class="panel-body">--><!--    <h4>Coming soon!</h4>--><!--  </div>--><!--</div>--></div><div class="col-xs-12 col-sm-12 col-md-12"><div class="panel panel-default"><div class=panel-heading><h3 class=panel-title>{{\'rating_title\'|translate}}</h3></div><div class=panel-body><div class=row><div class=col-sm-4 ng-repeat="rate in rating track by $index">{{rate.rdftype|translate}} :<uib-rating class=rating ng-model=doc.rating[$index].value max=5></uib-rating></div></div></div></div></div></div></div><div style="position:relative; width:auto; height:auto; margin:auto; top:100px" ng-hide=doc.iframe||!showArticle class=spinner><div class=bounce1></div><div class=bounce2></div><div class=bounce3></div></div><div style=height:100%;left:7px class="embed-responsive embed-responsive-4by3" ng-bind-html=doc.iframe></div></div>'),a.put("components/footer/footer.html",'<footer class=footer><div class=container><div style="float:left;margin:0px 10px"><img src=CARRE-FooterLogo.png width=36 height=40 alt=CARRE> <a href="http://cordis.europa.eu/" target=_blank><img alt=Picture1 src=Picture1-150x150.png width=30 height=30></a></div><div style="float:left;margin:0px 10px">CARRE project is partly funded by the EC under the grant no. FP7-ICT-611140</div></div></footer>'),a.put("components/modal/modal.html",'<div class=modal-header><button ng-if=modal.dismissable type=button ng-click=$dismiss() class=close>&times;</button><h4 ng-if=modal.title ng-bind=modal.title class=modal-title></h4></div><div class=modal-body><p ng-if=modal.text ng-bind=modal.text></p><div ng-if=modal.html ng-bind-html=modal.html></div></div><div class=modal-footer><button ng-repeat="button in modal.buttons" ng-class=button.classes ng-click=button.click($event) ng-bind=button.text class=btn></button></div>'),a.put("components/navbar/navbar.html",'<div class="navbar navbar-default navbar-static-top" ng-controller=NavbarCtrl><!--typical navbar--><div class=container><div class=navbar-header><button class=navbar-toggle type=button ng-click="isCollapsed = !isCollapsed"><span class=sr-only>Toggle navigation</span> <span class=icon-bar></span> <span class=icon-bar></span> <span class=icon-bar></span></button> <a href=# class=navbar-brand style=margin-top:-9px><img src=CARRE-FooterLogo.png width=36 height=40 alt=CARRE></a> <span class=brand style="font-size:larger;position:relative; top:13px" href=#>Educational Aggregator</span></div><div uib-collapse=isCollapsed class="navbar-collapse collapse"><ul class="nav navbar-nav"><li ng-show=isAdmin() ng-class="{active: isActive(\'/admin\')}"><a href=/admin>Admin</a></li></ul><ul class="nav navbar-nav navbar-right"><!--User functions--><li ng-show=user.username class=dropdown uib-dropdown><a href id=avatar class=nav-profile uib-dropdown-toggle><span>{{ user.username }}</span> <img gravatar-src=user.email class=img-circle></a><ul class=dropdown-menu uib-dropdown-menu><li><a href="" ng-click=logout()><i class="glyphicon glyphicon-log-out"></i> <span>{{\'logout\'|translate}}</span></a></li></ul></li><li ng-hide=isLoggedIn() ng-class="{active: isActive(\'/login\')}"><a href ng-click=login()>{{\'login\'|translate}}</a></li></ul></div></div></div>');
}]);